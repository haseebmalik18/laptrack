{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///Users/haseebulhaqmalik/Desktop/lap-lens/src/analysis/lap-loader.ts"],"sourcesContent":["/**\n * Lap Loader - Loads saved lap data from CSV/JSON files\n *\n * Reads telemetry from ./laps directory and parses into NormalizedTelemetryPoint arrays.\n */\n\nimport * as fs from 'fs';\nimport * as path from 'path';\nimport { NormalizedTelemetryPoint } from '../types/f1-2024-packets';\n\nexport interface LapInfo {\n  filePath: string;\n  lapNumber: number;\n  timestamp: string;\n  pointCount: number;\n}\n\nexport class LapLoader {\n  private lapsDir: string;\n\n  constructor(lapsDir: string = './laps') {\n    this.lapsDir = lapsDir;\n  }\n\n  // List all available laps from JSON metadata\n  listAvailableLaps(): LapInfo[] {\n    if (!fs.existsSync(this.lapsDir)) {\n      return [];\n    }\n\n    const files = fs.readdirSync(this.lapsDir)\n      .filter(f => f.endsWith('.json'))\n      .map(f => {\n        const jsonPath = path.join(this.lapsDir, f);\n        const metadata = JSON.parse(fs.readFileSync(jsonPath, 'utf-8'));\n        return {\n          filePath: jsonPath.replace('.json', '.csv'),\n          lapNumber: metadata.lapNumber,\n          timestamp: metadata.timestamp,\n          pointCount: metadata.pointCount,\n        };\n      })\n      .sort((a, b) => a.lapNumber - b.lapNumber);\n\n    return files;\n  }\n\n  // Load telemetry from CSV file (parses all columns including yaw)\n  loadLap(csvPath: string): NormalizedTelemetryPoint[] {\n    const content = fs.readFileSync(csvPath, 'utf-8');\n    const lines = content.split('\\n').slice(1);\n\n    const points: NormalizedTelemetryPoint[] = [];\n\n    for (const line of lines) {\n      if (!line.trim()) continue;\n\n      const parts = line.split(',').map(p => parseFloat(p));\n      if (parts.length < 11) continue;\n\n      points.push({\n        time: parts[0],\n        distance: parts[1],\n        x: parts[2],\n        y: parts[3],\n        speed: parts[4],\n        throttle: parts[5],\n        brake: parts[6],\n        steering: parts[7],\n        gear: parts[8],\n        rpm: parts[9] || 0,      // RPM column (index 9)\n        gLat: parts[10] || 0,    // gLat column (index 10)\n        gLong: parts[11] || 0,   // gLong column (index 11)\n        yaw: parts[12] || 0,     // yaw column (index 12) - Backwards compatibility for old laps\n        lapNum: 0,\n      });\n    }\n\n    return points;\n  }\n\n  // Load lap by lap number (looks up CSV path from metadata)\n  loadLapByNumber(lapNumber: number): NormalizedTelemetryPoint[] | null {\n    const laps = this.listAvailableLaps();\n    const lap = laps.find(l => l.lapNumber === lapNumber);\n\n    if (!lap) {\n      return null;\n    }\n\n    return this.loadLap(lap.filePath);\n  }\n}\n"],"names":[],"mappings":"AAAA;;;;CAIC;;;;AAED;AACA;;;AAUO,MAAM;IACH,QAAgB;IAExB,YAAY,UAAkB,QAAQ,CAAE;QACtC,IAAI,CAAC,OAAO,GAAG;IACjB;IAEA,6CAA6C;IAC7C,oBAA+B;QAC7B,IAAI,CAAC,2GAAa,CAAC,IAAI,CAAC,OAAO,GAAG;YAChC,OAAO,EAAE;QACX;QAEA,MAAM,QAAQ,4GAAc,CAAC,IAAI,CAAC,OAAO,EACtC,MAAM,CAAC,CAAA,IAAK,EAAE,QAAQ,CAAC,UACvB,GAAG,CAAC,CAAA;YACH,MAAM,WAAW,yGAAS,CAAC,IAAI,CAAC,OAAO,EAAE;YACzC,MAAM,WAAW,KAAK,KAAK,CAAC,6GAAe,CAAC,UAAU;YACtD,OAAO;gBACL,UAAU,SAAS,OAAO,CAAC,SAAS;gBACpC,WAAW,SAAS,SAAS;gBAC7B,WAAW,SAAS,SAAS;gBAC7B,YAAY,SAAS,UAAU;YACjC;QACF,GACC,IAAI,CAAC,CAAC,GAAG,IAAM,EAAE,SAAS,GAAG,EAAE,SAAS;QAE3C,OAAO;IACT;IAEA,kEAAkE;IAClE,QAAQ,OAAe,EAA8B;QACnD,MAAM,UAAU,6GAAe,CAAC,SAAS;QACzC,MAAM,QAAQ,QAAQ,KAAK,CAAC,MAAM,KAAK,CAAC;QAExC,MAAM,SAAqC,EAAE;QAE7C,KAAK,MAAM,QAAQ,MAAO;YACxB,IAAI,CAAC,KAAK,IAAI,IAAI;YAElB,MAAM,QAAQ,KAAK,KAAK,CAAC,KAAK,GAAG,CAAC,CAAA,IAAK,WAAW;YAClD,IAAI,MAAM,MAAM,GAAG,IAAI;YAEvB,OAAO,IAAI,CAAC;gBACV,MAAM,KAAK,CAAC,EAAE;gBACd,UAAU,KAAK,CAAC,EAAE;gBAClB,GAAG,KAAK,CAAC,EAAE;gBACX,GAAG,KAAK,CAAC,EAAE;gBACX,OAAO,KAAK,CAAC,EAAE;gBACf,UAAU,KAAK,CAAC,EAAE;gBAClB,OAAO,KAAK,CAAC,EAAE;gBACf,UAAU,KAAK,CAAC,EAAE;gBAClB,MAAM,KAAK,CAAC,EAAE;gBACd,KAAK,KAAK,CAAC,EAAE,IAAI;gBACjB,MAAM,KAAK,CAAC,GAAG,IAAI;gBACnB,OAAO,KAAK,CAAC,GAAG,IAAI;gBACpB,KAAK,KAAK,CAAC,GAAG,IAAI;gBAClB,QAAQ;YACV;QACF;QAEA,OAAO;IACT;IAEA,2DAA2D;IAC3D,gBAAgB,SAAiB,EAAqC;QACpE,MAAM,OAAO,IAAI,CAAC,iBAAiB;QACnC,MAAM,MAAM,KAAK,IAAI,CAAC,CAAA,IAAK,EAAE,SAAS,KAAK;QAE3C,IAAI,CAAC,KAAK;YACR,OAAO;QACT;QAEA,OAAO,IAAI,CAAC,OAAO,CAAC,IAAI,QAAQ;IAClC;AACF"}},
    {"offset": {"line": 134, "column": 0}, "map": {"version":3,"sources":["file:///Users/haseebulhaqmalik/Desktop/lap-lens/web/app/api/laps/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\nimport path from \"path\";\nimport fs from \"fs\";\nimport { LapLoader } from \"../../../../src/analysis/lap-loader\";\n\n// Format lap time from seconds to \"M:SS.mmm\" format\nfunction formatLapTime(seconds: number): string {\n  const mins = Math.floor(seconds / 60);\n  const secs = (seconds % 60).toFixed(3);\n  return `${mins}:${secs.padStart(6, '0')}`;\n}\n\n// GET /api/laps - Returns list of all available laps with metadata\nexport async function GET() {\n  const lapsDir = path.join(process.cwd(), \"..\", \"laps\");\n  const loader = new LapLoader(lapsDir);\n\n  const availableLaps = loader.listAvailableLaps();\n\n  const laps = availableLaps.map(lap => {\n    const metadataPath = lap.filePath.replace('.csv', '.json');\n    let lapTime = \"N/A\";\n\n    try {\n      if (fs.existsSync(metadataPath)) {\n        const metadata = JSON.parse(fs.readFileSync(metadataPath, 'utf-8'));\n        if (metadata.lapTime) {\n          lapTime = formatLapTime(metadata.lapTime);\n        }\n      }\n    } catch (err) {\n      console.error('Failed to read metadata:', err);\n    }\n\n    return {\n      lapNumber: lap.lapNumber,\n      timestamp: lap.timestamp,\n      pointCount: lap.pointCount,\n      lapTime,\n    };\n  });\n\n  return NextResponse.json({ laps });\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;;;;;AAEA,oDAAoD;AACpD,SAAS,cAAc,OAAe;IACpC,MAAM,OAAO,KAAK,KAAK,CAAC,UAAU;IAClC,MAAM,OAAO,CAAC,UAAU,EAAE,EAAE,OAAO,CAAC;IACpC,OAAO,GAAG,KAAK,CAAC,EAAE,KAAK,QAAQ,CAAC,GAAG,MAAM;AAC3C;AAGO,eAAe;IACpB,MAAM,UAAU,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,MAAM;IAC/C,MAAM,SAAS,IAAI,yKAAS,CAAC;IAE7B,MAAM,gBAAgB,OAAO,iBAAiB;IAE9C,MAAM,OAAO,cAAc,GAAG,CAAC,CAAA;QAC7B,MAAM,eAAe,IAAI,QAAQ,CAAC,OAAO,CAAC,QAAQ;QAClD,IAAI,UAAU;QAEd,IAAI;YACF,IAAI,wGAAE,CAAC,UAAU,CAAC,eAAe;gBAC/B,MAAM,WAAW,KAAK,KAAK,CAAC,wGAAE,CAAC,YAAY,CAAC,cAAc;gBAC1D,IAAI,SAAS,OAAO,EAAE;oBACpB,UAAU,cAAc,SAAS,OAAO;gBAC1C;YACF;QACF,EAAE,OAAO,KAAK;YACZ,QAAQ,KAAK,CAAC,4BAA4B;QAC5C;QAEA,OAAO;YACL,WAAW,IAAI,SAAS;YACxB,WAAW,IAAI,SAAS;YACxB,YAAY,IAAI,UAAU;YAC1B;QACF;IACF;IAEA,OAAO,iLAAY,CAAC,IAAI,CAAC;QAAE;IAAK;AAClC"}}]
}