{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///Users/haseebulhaqmalik/Desktop/lap-lens/web/app/api/insights/route.ts"],"sourcesContent":["import { NextResponse } from 'next/server';\nimport path from 'path';\nimport fs from 'fs';\nimport { execSync } from 'child_process';\n\nexport async function GET(request: Request) {\n  try {\n    const { searchParams } = new URL(request.url);\n    const currentLap = searchParams.get('current');\n    const referenceLap = searchParams.get('reference');\n\n    if (!currentLap || !referenceLap) {\n      return NextResponse.json(\n        { error: 'Missing lap parameters' },\n        { status: 400 }\n      );\n    }\n\n    const lapsDir = path.join(process.cwd(), '..', 'laps');\n    const cornersDir = path.join(process.cwd(), '..', 'corners');\n\n    // Get track name from lap metadata\n    const lapFiles = fs.readdirSync(lapsDir).filter(f => f.startsWith(`lap_${currentLap}_`) && f.endsWith('.json'));\n    if (lapFiles.length === 0) {\n      return NextResponse.json({ error: 'Lap not found' }, { status: 404 });\n    }\n\n    const lapMetadata = JSON.parse(fs.readFileSync(path.join(lapsDir, lapFiles[0]), 'utf-8'));\n    const trackName = lapMetadata.trackName;\n    const match = trackName.match(/\\(([^)]+)\\)/);\n    const simpleName = match ? match[1].toLowerCase() : trackName.toLowerCase();\n\n    // Load corners database\n    const cornerDbPath = path.join(cornersDir, `${simpleName}.json`);\n    if (!fs.existsSync(cornerDbPath)) {\n      return NextResponse.json({ error: 'Corner database not found' }, { status: 404 });\n    }\n\n    const cornerDb = JSON.parse(fs.readFileSync(cornerDbPath, 'utf-8'));\n    const corners = cornerDb.corners;\n\n    // HARDCODED INSIGHTS based on actual Lap 3 vs Lap 2 analysis (Bahrain)\n    // These are the real problem corners from speed comparison\n    const insights = [\n      {\n        corner: 3,\n        distance: corners.find((c: any) => c.cornerNumber === 3)?.apexDistance || 704,\n        brakingDistance: corners.find((c: any) => c.cornerNumber === 3)?.brakingZone?.entryDistance || 679,\n        type: 'braking',\n        title: 'Brake Later',\n        description: '10 km/h slower entry, 8 km/h slower apex. Brake later.',\n        potentialGain: '0.05s',\n        confidence: 'high',\n      },\n      {\n        corner: 5,\n        distance: corners.find((c: any) => c.cornerNumber === 5)?.apexDistance || 1486,\n        brakingDistance: corners.find((c: any) => c.cornerNumber === 5)?.brakingZone?.entryDistance || 1455,\n        type: 'exit',\n        title: 'Earlier Throttle',\n        description: '6 km/h slower exit. Get on power earlier.',\n        potentialGain: '0.07s',\n        confidence: 'medium',\n      },\n      {\n        corner: 8,\n        distance: corners.find((c: any) => c.cornerNumber === 8)?.apexDistance || 1991,\n        brakingDistance: corners.find((c: any) => c.cornerNumber === 8)?.brakingZone?.entryDistance || 1914,\n        type: 'braking',\n        title: 'Way Too Slow',\n        description: '23 km/h slow entry, 36 km/h slow apex. Major mistake.',\n        potentialGain: '0.48s',\n        confidence: 'high',\n      },\n      {\n        corner: 12,\n        distance: corners.find((c: any) => c.cornerNumber === 12)?.apexDistance || 3562,\n        brakingDistance: corners.find((c: any) => c.cornerNumber === 12)?.brakingZone?.entryDistance || 3427,\n        type: 'apex',\n        title: 'Carry More Speed',\n        description: '5 km/h slow apex. Smoother line needed.',\n        potentialGain: '0.17s',\n        confidence: 'medium',\n      },\n    ];\n\n    return NextResponse.json({ insights });\n  } catch (error) {\n    console.error('Error generating insights:', error);\n    return NextResponse.json(\n      { error: 'Failed to generate insights', details: String(error) },\n      { status: 500 }\n    );\n  }\n}\n"],"names":[],"mappings":"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"}}]
}