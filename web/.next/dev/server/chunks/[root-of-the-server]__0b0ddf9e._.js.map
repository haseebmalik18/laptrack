{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///Users/haseebulhaqmalik/Desktop/lap-lens/src/analysis/lap-loader.ts"],"sourcesContent":["import * as fs from 'fs';\nimport * as path from 'path';\nimport { NormalizedTelemetryPoint } from '../types/f1-2024-packets';\n\nexport interface LapInfo {\n  filePath: string;\n  lapNumber: number;\n  timestamp: string;\n  pointCount: number;\n}\n\nexport class LapLoader {\n  private lapsDir: string;\n\n  constructor(lapsDir: string = './laps') {\n    this.lapsDir = lapsDir;\n  }\n\n  listAvailableLaps(): LapInfo[] {\n    if (!fs.existsSync(this.lapsDir)) {\n      return [];\n    }\n\n    const files = fs.readdirSync(this.lapsDir)\n      .filter(f => f.endsWith('.json'))\n      .map(f => {\n        const jsonPath = path.join(this.lapsDir, f);\n        const metadata = JSON.parse(fs.readFileSync(jsonPath, 'utf-8'));\n        return {\n          filePath: jsonPath.replace('.json', '.csv'),\n          lapNumber: metadata.lapNumber,\n          timestamp: metadata.timestamp,\n          pointCount: metadata.pointCount,\n        };\n      })\n      .sort((a, b) => a.lapNumber - b.lapNumber);\n\n    return files;\n  }\n\n  loadLap(csvPath: string): NormalizedTelemetryPoint[] {\n    const content = fs.readFileSync(csvPath, 'utf-8');\n    const lines = content.split('\\n').slice(1);\n\n    const points: NormalizedTelemetryPoint[] = [];\n\n    for (const line of lines) {\n      if (!line.trim()) continue;\n\n      const parts = line.split(',').map(p => parseFloat(p));\n      if (parts.length < 11) continue;\n\n      points.push({\n        time: parts[0],\n        distance: parts[1],\n        x: parts[2],\n        y: parts[3],\n        speed: parts[4],\n        throttle: parts[5],\n        brake: parts[6],\n        steering: parts[7],\n        gear: parts[8],\n        gLat: parts[9],\n        gLong: parts[10],\n        yaw: parts[11] || 0, // Backwards compatibility for old laps\n        lapNum: 0,\n      });\n    }\n\n    return points;\n  }\n\n  loadLapByNumber(lapNumber: number): NormalizedTelemetryPoint[] | null {\n    const laps = this.listAvailableLaps();\n    const lap = laps.find(l => l.lapNumber === lapNumber);\n\n    if (!lap) {\n      return null;\n    }\n\n    return this.loadLap(lap.filePath);\n  }\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;;;AAUO,MAAM;IACH,QAAgB;IAExB,YAAY,UAAkB,QAAQ,CAAE;QACtC,IAAI,CAAC,OAAO,GAAG;IACjB;IAEA,oBAA+B;QAC7B,IAAI,CAAC,2GAAa,CAAC,IAAI,CAAC,OAAO,GAAG;YAChC,OAAO,EAAE;QACX;QAEA,MAAM,QAAQ,4GAAc,CAAC,IAAI,CAAC,OAAO,EACtC,MAAM,CAAC,CAAA,IAAK,EAAE,QAAQ,CAAC,UACvB,GAAG,CAAC,CAAA;YACH,MAAM,WAAW,yGAAS,CAAC,IAAI,CAAC,OAAO,EAAE;YACzC,MAAM,WAAW,KAAK,KAAK,CAAC,6GAAe,CAAC,UAAU;YACtD,OAAO;gBACL,UAAU,SAAS,OAAO,CAAC,SAAS;gBACpC,WAAW,SAAS,SAAS;gBAC7B,WAAW,SAAS,SAAS;gBAC7B,YAAY,SAAS,UAAU;YACjC;QACF,GACC,IAAI,CAAC,CAAC,GAAG,IAAM,EAAE,SAAS,GAAG,EAAE,SAAS;QAE3C,OAAO;IACT;IAEA,QAAQ,OAAe,EAA8B;QACnD,MAAM,UAAU,6GAAe,CAAC,SAAS;QACzC,MAAM,QAAQ,QAAQ,KAAK,CAAC,MAAM,KAAK,CAAC;QAExC,MAAM,SAAqC,EAAE;QAE7C,KAAK,MAAM,QAAQ,MAAO;YACxB,IAAI,CAAC,KAAK,IAAI,IAAI;YAElB,MAAM,QAAQ,KAAK,KAAK,CAAC,KAAK,GAAG,CAAC,CAAA,IAAK,WAAW;YAClD,IAAI,MAAM,MAAM,GAAG,IAAI;YAEvB,OAAO,IAAI,CAAC;gBACV,MAAM,KAAK,CAAC,EAAE;gBACd,UAAU,KAAK,CAAC,EAAE;gBAClB,GAAG,KAAK,CAAC,EAAE;gBACX,GAAG,KAAK,CAAC,EAAE;gBACX,OAAO,KAAK,CAAC,EAAE;gBACf,UAAU,KAAK,CAAC,EAAE;gBAClB,OAAO,KAAK,CAAC,EAAE;gBACf,UAAU,KAAK,CAAC,EAAE;gBAClB,MAAM,KAAK,CAAC,EAAE;gBACd,MAAM,KAAK,CAAC,EAAE;gBACd,OAAO,KAAK,CAAC,GAAG;gBAChB,KAAK,KAAK,CAAC,GAAG,IAAI;gBAClB,QAAQ;YACV;QACF;QAEA,OAAO;IACT;IAEA,gBAAgB,SAAiB,EAAqC;QACpE,MAAM,OAAO,IAAI,CAAC,iBAAiB;QACnC,MAAM,MAAM,KAAK,IAAI,CAAC,CAAA,IAAK,EAAE,SAAS,KAAK;QAE3C,IAAI,CAAC,KAAK;YACR,OAAO;QACT;QAEA,OAAO,IAAI,CAAC,OAAO,CAAC,IAAI,QAAQ;IAClC;AACF"}},
    {"offset": {"line": 126, "column": 0}, "map": {"version":3,"sources":["file:///Users/haseebulhaqmalik/Desktop/lap-lens/src/analysis/interpolation.ts"],"sourcesContent":["export function lerp(a: number, b: number, t: number): number {\n  return a + (b - a) * t;\n}\n\nexport function interpolateValue(\n  x: number,\n  x0: number,\n  x1: number,\n  y0: number,\n  y1: number\n): number {\n  if (x1 === x0) return y0;\n  const t = (x - x0) / (x1 - x0);\n  return lerp(y0, y1, t);\n}\n\nexport interface InterpolatePoint {\n  [key: string]: number;\n}\n\nexport function interpolatePoint<T extends InterpolatePoint>(\n  distance: number,\n  point0: T,\n  point1: T,\n  distanceKey: string = 'distance'\n): T {\n  const d0 = point0[distanceKey];\n  const d1 = point1[distanceKey];\n\n  const result: any = {};\n\n  for (const key in point0) {\n    if (typeof point0[key] === 'number') {\n      result[key] = interpolateValue(distance, d0, d1, point0[key], point1[key]);\n    } else {\n      result[key] = point0[key];\n    }\n  }\n\n  return result as T;\n}\n"],"names":[],"mappings":";;;;;;;;AAAO,SAAS,KAAK,CAAS,EAAE,CAAS,EAAE,CAAS;IAClD,OAAO,IAAI,CAAC,IAAI,CAAC,IAAI;AACvB;AAEO,SAAS,iBACd,CAAS,EACT,EAAU,EACV,EAAU,EACV,EAAU,EACV,EAAU;IAEV,IAAI,OAAO,IAAI,OAAO;IACtB,MAAM,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,KAAK,EAAE;IAC7B,OAAO,KAAK,IAAI,IAAI;AACtB;AAMO,SAAS,iBACd,QAAgB,EAChB,MAAS,EACT,MAAS,EACT,cAAsB,UAAU;IAEhC,MAAM,KAAK,MAAM,CAAC,YAAY;IAC9B,MAAM,KAAK,MAAM,CAAC,YAAY;IAE9B,MAAM,SAAc,CAAC;IAErB,IAAK,MAAM,OAAO,OAAQ;QACxB,IAAI,OAAO,MAAM,CAAC,IAAI,KAAK,UAAU;YACnC,MAAM,CAAC,IAAI,GAAG,iBAAiB,UAAU,IAAI,IAAI,MAAM,CAAC,IAAI,EAAE,MAAM,CAAC,IAAI;QAC3E,OAAO;YACL,MAAM,CAAC,IAAI,GAAG,MAAM,CAAC,IAAI;QAC3B;IACF;IAEA,OAAO;AACT"}},
    {"offset": {"line": 159, "column": 0}, "map": {"version":3,"sources":["file:///Users/haseebulhaqmalik/Desktop/lap-lens/src/analysis/lap-normalizer.ts"],"sourcesContent":["import { NormalizedTelemetryPoint } from '../types/f1-2024-packets';\nimport { interpolatePoint } from './interpolation';\n\nexport interface NormalizerOptions {\n  sampleRate: number;\n}\n\nexport class LapNormalizer {\n  private options: NormalizerOptions;\n\n  constructor(options: Partial<NormalizerOptions> = {}) {\n    this.options = {\n      sampleRate: options.sampleRate || 1.0,\n    };\n  }\n\n  normalize(points: NormalizedTelemetryPoint[]): NormalizedTelemetryPoint[] {\n    if (points.length < 2) {\n      return points;\n    }\n\n    const sorted = [...points].sort((a, b) => a.distance - b.distance);\n\n    const minDistance = Math.floor(sorted[0].distance);\n    const maxDistance = Math.ceil(sorted[sorted.length - 1].distance);\n\n    const normalized: NormalizedTelemetryPoint[] = [];\n    let pointIndex = 0;\n\n    for (let d = minDistance; d <= maxDistance; d += this.options.sampleRate) {\n      while (pointIndex < sorted.length - 1 && sorted[pointIndex + 1].distance < d) {\n        pointIndex++;\n      }\n\n      if (pointIndex >= sorted.length - 1) {\n        break;\n      }\n\n      const point0 = sorted[pointIndex];\n      const point1 = sorted[pointIndex + 1];\n\n      if (point1.distance < d) {\n        continue;\n      }\n\n      const interpolated = interpolatePoint(d, point0, point1, 'distance');\n      interpolated.distance = d;\n\n      normalized.push(interpolated);\n    }\n\n    return normalized;\n  }\n\n  getTrackLength(points: NormalizedTelemetryPoint[]): number {\n    if (points.length === 0) return 0;\n    const sorted = [...points].sort((a, b) => a.distance - b.distance);\n    return sorted[sorted.length - 1].distance - sorted[0].distance;\n  }\n}\n"],"names":[],"mappings":";;;;AACA;;AAMO,MAAM;IACH,QAA2B;IAEnC,YAAY,UAAsC,CAAC,CAAC,CAAE;QACpD,IAAI,CAAC,OAAO,GAAG;YACb,YAAY,QAAQ,UAAU,IAAI;QACpC;IACF;IAEA,UAAU,MAAkC,EAA8B;QACxE,IAAI,OAAO,MAAM,GAAG,GAAG;YACrB,OAAO;QACT;QAEA,MAAM,SAAS;eAAI;SAAO,CAAC,IAAI,CAAC,CAAC,GAAG,IAAM,EAAE,QAAQ,GAAG,EAAE,QAAQ;QAEjE,MAAM,cAAc,KAAK,KAAK,CAAC,MAAM,CAAC,EAAE,CAAC,QAAQ;QACjD,MAAM,cAAc,KAAK,IAAI,CAAC,MAAM,CAAC,OAAO,MAAM,GAAG,EAAE,CAAC,QAAQ;QAEhE,MAAM,aAAyC,EAAE;QACjD,IAAI,aAAa;QAEjB,IAAK,IAAI,IAAI,aAAa,KAAK,aAAa,KAAK,IAAI,CAAC,OAAO,CAAC,UAAU,CAAE;YACxE,MAAO,aAAa,OAAO,MAAM,GAAG,KAAK,MAAM,CAAC,aAAa,EAAE,CAAC,QAAQ,GAAG,EAAG;gBAC5E;YACF;YAEA,IAAI,cAAc,OAAO,MAAM,GAAG,GAAG;gBACnC;YACF;YAEA,MAAM,SAAS,MAAM,CAAC,WAAW;YACjC,MAAM,SAAS,MAAM,CAAC,aAAa,EAAE;YAErC,IAAI,OAAO,QAAQ,GAAG,GAAG;gBACvB;YACF;YAEA,MAAM,eAAe,IAAA,gLAAgB,EAAC,GAAG,QAAQ,QAAQ;YACzD,aAAa,QAAQ,GAAG;YAExB,WAAW,IAAI,CAAC;QAClB;QAEA,OAAO;IACT;IAEA,eAAe,MAAkC,EAAU;QACzD,IAAI,OAAO,MAAM,KAAK,GAAG,OAAO;QAChC,MAAM,SAAS;eAAI;SAAO,CAAC,IAAI,CAAC,CAAC,GAAG,IAAM,EAAE,QAAQ,GAAG,EAAE,QAAQ;QACjE,OAAO,MAAM,CAAC,OAAO,MAAM,GAAG,EAAE,CAAC,QAAQ,GAAG,MAAM,CAAC,EAAE,CAAC,QAAQ;IAChE;AACF"}},
    {"offset": {"line": 213, "column": 0}, "map": {"version":3,"sources":["file:///Users/haseebulhaqmalik/Desktop/lap-lens/web/app/api/laps/%5BlapNumber%5D/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\nimport path from \"path\";\nimport fs from \"fs\";\nimport { LapLoader } from \"../../../../../src/analysis/lap-loader\";\nimport { LapNormalizer } from \"../../../../../src/analysis/lap-normalizer\";\n\nexport async function GET(\n  _request: Request,\n  { params }: { params: Promise<{ lapNumber: string }> }\n) {\n  const { lapNumber } = await params;\n  const lapsDir = path.join(process.cwd(), \"..\", \"laps\");\n  const loader = new LapLoader(lapsDir);\n\n  const lapInfo = loader.listAvailableLaps().find(\n    l => l.lapNumber === parseInt(lapNumber)\n  );\n\n  if (!lapInfo) {\n    return NextResponse.json({ error: \"Lap not found\" }, { status: 404 });\n  }\n\n  const rawTelemetry = loader.loadLap(lapInfo.filePath);\n\n  // Normalize to 1 sample per meter for consistent visualization\n  const normalizer = new LapNormalizer({ sampleRate: 1.0 });\n  const telemetry = normalizer.normalize(rawTelemetry);\n\n  const metadataPath = lapInfo.filePath.replace('.csv', '.json');\n\n  let metadata = {};\n  try {\n    if (fs.existsSync(metadataPath)) {\n      metadata = JSON.parse(fs.readFileSync(metadataPath, 'utf-8'));\n    }\n  } catch (err) {\n    console.error('Failed to read metadata:', err);\n  }\n\n  return NextResponse.json({\n    lapNumber: parseInt(lapNumber),\n    metadata,\n    telemetry,\n  });\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;AACA;;;;;;AAEO,eAAe,IACpB,QAAiB,EACjB,EAAE,MAAM,EAA8C;IAEtD,MAAM,EAAE,SAAS,EAAE,GAAG,MAAM;IAC5B,MAAM,UAAU,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,MAAM;IAC/C,MAAM,SAAS,IAAI,yKAAS,CAAC;IAE7B,MAAM,UAAU,OAAO,iBAAiB,GAAG,IAAI,CAC7C,CAAA,IAAK,EAAE,SAAS,KAAK,SAAS;IAGhC,IAAI,CAAC,SAAS;QACZ,OAAO,iLAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAgB,GAAG;YAAE,QAAQ;QAAI;IACrE;IAEA,MAAM,eAAe,OAAO,OAAO,CAAC,QAAQ,QAAQ;IAEpD,+DAA+D;IAC/D,MAAM,aAAa,IAAI,iLAAa,CAAC;QAAE,YAAY;IAAI;IACvD,MAAM,YAAY,WAAW,SAAS,CAAC;IAEvC,MAAM,eAAe,QAAQ,QAAQ,CAAC,OAAO,CAAC,QAAQ;IAEtD,IAAI,WAAW,CAAC;IAChB,IAAI;QACF,IAAI,wGAAE,CAAC,UAAU,CAAC,eAAe;YAC/B,WAAW,KAAK,KAAK,CAAC,wGAAE,CAAC,YAAY,CAAC,cAAc;QACtD;IACF,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC,4BAA4B;IAC5C;IAEA,OAAO,iLAAY,CAAC,IAAI,CAAC;QACvB,WAAW,SAAS;QACpB;QACA;IACF;AACF"}}]
}