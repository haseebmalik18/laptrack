{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 58, "column": 0}, "map": {"version":3,"sources":["file:///Users/haseebulhaqmalik/Desktop/lap-lens/src/analysis/lap-loader.ts"],"sourcesContent":["/**\n * Lap Loader - Loads saved lap data from CSV/JSON files\n *\n * Reads telemetry from ./laps directory and parses into NormalizedTelemetryPoint arrays.\n */\n\nimport * as fs from 'fs';\nimport * as path from 'path';\nimport { NormalizedTelemetryPoint } from '../types/f1-2024-packets';\n\nexport interface LapInfo {\n  filePath: string;\n  lapNumber: number;\n  timestamp: string;\n  pointCount: number;\n}\n\nexport class LapLoader {\n  private lapsDir: string;\n\n  constructor(lapsDir: string = './laps') {\n    this.lapsDir = lapsDir;\n  }\n\n  // List all available laps from JSON metadata\n  listAvailableLaps(): LapInfo[] {\n    if (!fs.existsSync(this.lapsDir)) {\n      return [];\n    }\n\n    const files = fs.readdirSync(this.lapsDir)\n      .filter(f => f.endsWith('.json'))\n      .map(f => {\n        const jsonPath = path.join(this.lapsDir, f);\n        const metadata = JSON.parse(fs.readFileSync(jsonPath, 'utf-8'));\n        return {\n          filePath: jsonPath.replace('.json', '.csv'),\n          lapNumber: metadata.lapNumber,\n          timestamp: metadata.timestamp,\n          pointCount: metadata.pointCount,\n        };\n      })\n      .sort((a, b) => a.lapNumber - b.lapNumber);\n\n    return files;\n  }\n\n  // Load telemetry from CSV file (parses all columns including yaw)\n  loadLap(csvPath: string): NormalizedTelemetryPoint[] {\n    const content = fs.readFileSync(csvPath, 'utf-8');\n    const lines = content.split('\\n').slice(1);\n\n    const points: NormalizedTelemetryPoint[] = [];\n\n    for (const line of lines) {\n      if (!line.trim()) continue;\n\n      const parts = line.split(',').map(p => parseFloat(p));\n      if (parts.length < 11) continue;\n\n      points.push({\n        time: parts[0],\n        distance: parts[1],\n        x: parts[2],\n        y: parts[3],\n        speed: parts[4],\n        throttle: parts[5],\n        brake: parts[6],\n        steering: parts[7],\n        gear: parts[8],\n        rpm: parts[9] || 0,      // RPM column (index 9)\n        gLat: parts[10] || 0,    // gLat column (index 10)\n        gLong: parts[11] || 0,   // gLong column (index 11)\n        yaw: parts[12] || 0,     // yaw column (index 12) - Backwards compatibility for old laps\n        lapNum: 0,\n      });\n    }\n\n    return points;\n  }\n\n  // Load lap by lap number (looks up CSV path from metadata)\n  loadLapByNumber(lapNumber: number): NormalizedTelemetryPoint[] | null {\n    const laps = this.listAvailableLaps();\n    const lap = laps.find(l => l.lapNumber === lapNumber);\n\n    if (!lap) {\n      return null;\n    }\n\n    return this.loadLap(lap.filePath);\n  }\n}\n"],"names":[],"mappings":"AAAA;;;;CAIC;;;;AAED;AACA;;;AAUO,MAAM;IACH,QAAgB;IAExB,YAAY,UAAkB,QAAQ,CAAE;QACtC,IAAI,CAAC,OAAO,GAAG;IACjB;IAEA,6CAA6C;IAC7C,oBAA+B;QAC7B,IAAI,CAAC,2GAAa,CAAC,IAAI,CAAC,OAAO,GAAG;YAChC,OAAO,EAAE;QACX;QAEA,MAAM,QAAQ,4GAAc,CAAC,IAAI,CAAC,OAAO,EACtC,MAAM,CAAC,CAAA,IAAK,EAAE,QAAQ,CAAC,UACvB,GAAG,CAAC,CAAA;YACH,MAAM,WAAW,yGAAS,CAAC,IAAI,CAAC,OAAO,EAAE;YACzC,MAAM,WAAW,KAAK,KAAK,CAAC,6GAAe,CAAC,UAAU;YACtD,OAAO;gBACL,UAAU,SAAS,OAAO,CAAC,SAAS;gBACpC,WAAW,SAAS,SAAS;gBAC7B,WAAW,SAAS,SAAS;gBAC7B,YAAY,SAAS,UAAU;YACjC;QACF,GACC,IAAI,CAAC,CAAC,GAAG,IAAM,EAAE,SAAS,GAAG,EAAE,SAAS;QAE3C,OAAO;IACT;IAEA,kEAAkE;IAClE,QAAQ,OAAe,EAA8B;QACnD,MAAM,UAAU,6GAAe,CAAC,SAAS;QACzC,MAAM,QAAQ,QAAQ,KAAK,CAAC,MAAM,KAAK,CAAC;QAExC,MAAM,SAAqC,EAAE;QAE7C,KAAK,MAAM,QAAQ,MAAO;YACxB,IAAI,CAAC,KAAK,IAAI,IAAI;YAElB,MAAM,QAAQ,KAAK,KAAK,CAAC,KAAK,GAAG,CAAC,CAAA,IAAK,WAAW;YAClD,IAAI,MAAM,MAAM,GAAG,IAAI;YAEvB,OAAO,IAAI,CAAC;gBACV,MAAM,KAAK,CAAC,EAAE;gBACd,UAAU,KAAK,CAAC,EAAE;gBAClB,GAAG,KAAK,CAAC,EAAE;gBACX,GAAG,KAAK,CAAC,EAAE;gBACX,OAAO,KAAK,CAAC,EAAE;gBACf,UAAU,KAAK,CAAC,EAAE;gBAClB,OAAO,KAAK,CAAC,EAAE;gBACf,UAAU,KAAK,CAAC,EAAE;gBAClB,MAAM,KAAK,CAAC,EAAE;gBACd,KAAK,KAAK,CAAC,EAAE,IAAI;gBACjB,MAAM,KAAK,CAAC,GAAG,IAAI;gBACnB,OAAO,KAAK,CAAC,GAAG,IAAI;gBACpB,KAAK,KAAK,CAAC,GAAG,IAAI;gBAClB,QAAQ;YACV;QACF;QAEA,OAAO;IACT;IAEA,2DAA2D;IAC3D,gBAAgB,SAAiB,EAAqC;QACpE,MAAM,OAAO,IAAI,CAAC,iBAAiB;QACnC,MAAM,MAAM,KAAK,IAAI,CAAC,CAAA,IAAK,EAAE,SAAS,KAAK;QAE3C,IAAI,CAAC,KAAK;YACR,OAAO;QACT;QAEA,OAAO,IAAI,CAAC,OAAO,CAAC,IAAI,QAAQ;IAClC;AACF"}},
    {"offset": {"line": 134, "column": 0}, "map": {"version":3,"sources":["file:///Users/haseebulhaqmalik/Desktop/lap-lens/web/app/api/laps/%5BlapNumber%5D/route.ts"],"sourcesContent":["import { NextResponse } from \"next/server\";\nimport path from \"path\";\nimport fs from \"fs\";\nimport { LapLoader } from \"../../../../../src/analysis/lap-loader\";\n\n// GET /api/laps/[lapNumber] - Returns telemetry data for specific lap\nexport async function GET(\n  _request: Request,\n  { params }: { params: Promise<{ lapNumber: string }> }\n) {\n  const { lapNumber } = await params;\n  const lapsDir = path.join(process.cwd(), \"..\", \"laps\");\n  const loader = new LapLoader(lapsDir);\n\n  const lapInfo = loader.listAvailableLaps().find(\n    l => l.lapNumber === parseInt(lapNumber)\n  );\n\n  if (!lapInfo) {\n    return NextResponse.json({ error: \"Lap not found\" }, { status: 404 });\n  }\n\n  const rawTelemetry = loader.loadLap(lapInfo.filePath);\n  const metadataPath = lapInfo.filePath.replace('.csv', '.json');\n\n  // Load lap metadata (track name, car, lap time, etc.)\n  let metadata = {};\n  try {\n    if (fs.existsSync(metadataPath)) {\n      metadata = JSON.parse(fs.readFileSync(metadataPath, 'utf-8'));\n    }\n  } catch (err) {\n    console.error('Failed to read metadata:', err);\n  }\n\n  // Normalize time to start from 0 (server-side normalization)\n  if (rawTelemetry.length > 0) {\n    const startTime = rawTelemetry[0].time;\n    rawTelemetry.forEach((point: any) => {\n      point.time = point.time - startTime;\n    });\n  }\n\n  return NextResponse.json(\n    {\n      lapNumber: parseInt(lapNumber),\n      metadata,\n      telemetry: rawTelemetry,\n    },\n    {\n      headers: {\n        'Cache-Control': 'no-cache',\n      },\n    }\n  );\n}\n"],"names":[],"mappings":";;;;AAAA;AACA;AACA;AACA;;;;;AAGO,eAAe,IACpB,QAAiB,EACjB,EAAE,MAAM,EAA8C;IAEtD,MAAM,EAAE,SAAS,EAAE,GAAG,MAAM;IAC5B,MAAM,UAAU,4GAAI,CAAC,IAAI,CAAC,QAAQ,GAAG,IAAI,MAAM;IAC/C,MAAM,SAAS,IAAI,yKAAS,CAAC;IAE7B,MAAM,UAAU,OAAO,iBAAiB,GAAG,IAAI,CAC7C,CAAA,IAAK,EAAE,SAAS,KAAK,SAAS;IAGhC,IAAI,CAAC,SAAS;QACZ,OAAO,iLAAY,CAAC,IAAI,CAAC;YAAE,OAAO;QAAgB,GAAG;YAAE,QAAQ;QAAI;IACrE;IAEA,MAAM,eAAe,OAAO,OAAO,CAAC,QAAQ,QAAQ;IACpD,MAAM,eAAe,QAAQ,QAAQ,CAAC,OAAO,CAAC,QAAQ;IAEtD,sDAAsD;IACtD,IAAI,WAAW,CAAC;IAChB,IAAI;QACF,IAAI,wGAAE,CAAC,UAAU,CAAC,eAAe;YAC/B,WAAW,KAAK,KAAK,CAAC,wGAAE,CAAC,YAAY,CAAC,cAAc;QACtD;IACF,EAAE,OAAO,KAAK;QACZ,QAAQ,KAAK,CAAC,4BAA4B;IAC5C;IAEA,6DAA6D;IAC7D,IAAI,aAAa,MAAM,GAAG,GAAG;QAC3B,MAAM,YAAY,YAAY,CAAC,EAAE,CAAC,IAAI;QACtC,aAAa,OAAO,CAAC,CAAC;YACpB,MAAM,IAAI,GAAG,MAAM,IAAI,GAAG;QAC5B;IACF;IAEA,OAAO,iLAAY,CAAC,IAAI,CACtB;QACE,WAAW,SAAS;QACpB;QACA,WAAW;IACb,GACA;QACE,SAAS;YACP,iBAAiB;QACnB;IACF;AAEJ"}}]
}