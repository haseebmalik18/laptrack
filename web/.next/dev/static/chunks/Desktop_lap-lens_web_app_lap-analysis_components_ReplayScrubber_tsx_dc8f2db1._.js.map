{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/haseebulhaqmalik/Desktop/lap-lens/web/app/lap-analysis/components/ReplayScrubber.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useRef } from \"react\";\n\ninterface ReplayScrubberProps {\n  lapData: any;\n  currentIndex: number;\n  isPlaying: boolean;\n  playbackSpeed: number;\n  onIndexChange: (index: number) => void;\n  onPlayPause: () => void;\n  onSpeedChange: (speed: number) => void;\n}\n\nexport function ReplayScrubber({\n  lapData,\n  currentIndex,\n  isPlaying,\n  playbackSpeed,\n  onIndexChange,\n  onPlayPause,\n  onSpeedChange,\n}: ReplayScrubberProps) {\n  const animationFrameRef = useRef<number | null>(null);\n  const lastTimeRef = useRef<number>(0);\n\n  useEffect(() => {\n    if (!isPlaying || !lapData?.telemetry) return;\n\n    const animate = (currentTime: number) => {\n      if (!lastTimeRef.current) {\n        lastTimeRef.current = currentTime;\n      }\n\n      const deltaTime = (currentTime - lastTimeRef.current) / 1000; // Convert to seconds\n\n      if (deltaTime >= 0.016) { // ~60fps\n        onIndexChange((prev: number) => {\n          if (prev >= lapData.telemetry.length - 1) {\n            return 0;\n          }\n\n          // Calculate how many points to advance based on real time\n          // Each telemetry point represents ~1 meter, car speed in km/h\n          const currentPoint = lapData.telemetry[Math.floor(prev)];\n\n          // Use actual speed but with a minimum of 60 km/h to prevent crawling in braking zones\n          const speed = Math.max(currentPoint?.speed || 150, 60);\n          const metersPerSecond = (speed * 1000) / 3600; // Convert km/h to m/s\n\n          // Smooth interpolation between points for fluid animation\n          const pointsToAdvance = metersPerSecond * deltaTime * playbackSpeed * 2.5; // 2.5x multiplier for smoother visual flow\n\n          return Math.min(prev + pointsToAdvance, lapData.telemetry.length - 1);\n        });\n        lastTimeRef.current = currentTime;\n      }\n\n      animationFrameRef.current = requestAnimationFrame(animate);\n    };\n\n    animationFrameRef.current = requestAnimationFrame(animate);\n\n    return () => {\n      if (animationFrameRef.current !== null) {\n        cancelAnimationFrame(animationFrameRef.current);\n      }\n      lastTimeRef.current = 0;\n    };\n  }, [isPlaying, playbackSpeed, lapData, onIndexChange]);\n\n  if (!lapData?.telemetry) return null;\n\n  const totalPoints = lapData.telemetry.length;\n  const currentPoint = lapData.telemetry[Math.floor(currentIndex)];\n  const progress = (currentIndex / totalPoints) * 100;\n\n  const formatTime = (seconds: number) => {\n    const mins = Math.floor(seconds / 60);\n    const secs = (seconds % 60).toFixed(3);\n    return `${mins}:${secs.padStart(6, '0')}`;\n  };\n\n  return (\n    <div className=\"border border-zinc-800 bg-black mx-auto\" style={{ maxWidth: \"1200px\" }}>\n      <div className=\"flex items-center justify-between px-6 py-3 border-b border-zinc-800\">\n        {/* Left - Playback Controls */}\n        <div className=\"flex items-center gap-4\">\n          <button\n            onClick={onPlayPause}\n            className=\"flex h-9 w-9 items-center justify-center bg-zinc-900 border border-zinc-700 hover:bg-zinc-800 transition-colors\"\n          >\n            {isPlaying ? (\n              <svg className=\"h-4 w-4\" fill=\"white\" viewBox=\"0 0 24 24\">\n                <rect x=\"6\" y=\"4\" width=\"4\" height=\"16\" />\n                <rect x=\"14\" y=\"4\" width=\"4\" height=\"16\" />\n              </svg>\n            ) : (\n              <svg className=\"h-4 w-4\" fill=\"white\" viewBox=\"0 0 24 24\">\n                <path d=\"M8 5v14l11-7z\" />\n              </svg>\n            )}\n          </button>\n\n          <div className=\"flex items-center gap-2\">\n            <span className=\"text-[10px] text-zinc-500 uppercase tracking-wider\">Playback</span>\n            {[0.5, 1, 2, 4].map((speed) => (\n              <button\n                key={speed}\n                onClick={() => onSpeedChange(speed)}\n                className={`px-3 py-1 text-xs font-mono transition-colors border ${\n                  playbackSpeed === speed\n                    ? \"bg-blue-500 text-white border-blue-500\"\n                    : \"bg-zinc-900 text-zinc-400 border-zinc-700 hover:bg-zinc-800\"\n                }`}\n              >\n                {speed}x\n              </button>\n            ))}\n          </div>\n        </div>\n\n        {/* Right - Current Position Info */}\n        <div className=\"flex items-center gap-6\">\n          <div className=\"text-right\">\n            <div className=\"text-[10px] text-zinc-500 uppercase tracking-wider\">Time</div>\n            <div className=\"text-sm font-mono text-white tabular-nums\">\n              {formatTime(currentPoint?.time || 0)}\n            </div>\n          </div>\n          <div className=\"text-right\">\n            <div className=\"text-[10px] text-zinc-500 uppercase tracking-wider\">Distance</div>\n            <div className=\"text-sm font-mono text-white tabular-nums\">\n              {Math.round(currentPoint?.distance || 0)}m\n            </div>\n          </div>\n          <div className=\"text-right\">\n            <div className=\"text-[10px] text-zinc-500 uppercase tracking-wider\">Progress</div>\n            <div className=\"text-sm font-mono text-white tabular-nums\">\n              {progress.toFixed(1)}%\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* Timeline Scrubber */}\n      <div className=\"px-6 py-4 bg-zinc-950\">\n        <div className=\"relative\">\n          <input\n            type=\"range\"\n            min=\"0\"\n            max={totalPoints - 1}\n            value={currentIndex}\n            onChange={(e) => onIndexChange(Number(e.target.value))}\n            className=\"w-full h-1 bg-zinc-800 appearance-none cursor-pointer\n              [&::-webkit-slider-thumb]:appearance-none\n              [&::-webkit-slider-thumb]:w-3\n              [&::-webkit-slider-thumb]:h-3\n              [&::-webkit-slider-thumb]:bg-blue-500\n              [&::-webkit-slider-thumb]:cursor-pointer\n              [&::-webkit-slider-thumb]:border-2\n              [&::-webkit-slider-thumb]:border-white\n              [&::-moz-range-thumb]:w-3\n              [&::-moz-range-thumb]:h-3\n              [&::-moz-range-thumb]:bg-blue-500\n              [&::-moz-range-thumb]:border-2\n              [&::-moz-range-thumb]:border-white\n              [&::-moz-range-thumb]:cursor-pointer\"\n            style={{\n              background: `linear-gradient(to right, #3b82f6 0%, #3b82f6 ${progress}%, #27272a ${progress}%, #27272a 100%)`\n            }}\n          />\n        </div>\n        <div className=\"mt-2 flex justify-between text-[10px] text-zinc-600 font-mono\">\n          <span>0:00.000</span>\n          <span>{formatTime(lapData.telemetry[totalPoints - 1]?.time || 0)}</span>\n        </div>\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}