{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///Users/haseebulhaqmalik/Desktop/lap-lens/web/app/components/ImprovementInsightsPanel.tsx"],"sourcesContent":["\"use client\";\n\nimport { useEffect, useState } from \"react\";\n\ninterface ImprovementInsightsPanelProps {\n  currentLapNumber: number;\n  referenceLapNumber?: number;\n  currentIndex?: number;\n  lapData?: any;\n}\n\ninterface Insight {\n  corner: number;\n  distance: number; // Apex distance\n  brakingDistance: number; // Braking zone entry distance\n  type: string;\n  title: string;\n  description: string;\n  potentialGain: string;\n  confidence: 'high' | 'medium' | 'low';\n}\n\nexport function ImprovementInsightsPanel({\n  currentLapNumber,\n  referenceLapNumber,\n  currentIndex = 0,\n  lapData\n}: ImprovementInsightsPanelProps) {\n  const [insights, setInsights] = useState<Insight[]>([]);\n  const [loading, setLoading] = useState(false);\n  const [activeInsight, setActiveInsight] = useState<Insight | null>(null);\n\n  useEffect(() => {\n    if (!referenceLapNumber) return;\n\n    setLoading(true);\n\n    // Fetch real insights from API\n    fetch(`/api/insights?current=${currentLapNumber}&reference=${referenceLapNumber}`)\n      .then(res => res.json())\n      .then(data => {\n        if (data.error) {\n          console.error('Failed to load insights:', data.error);\n          setInsights([]);\n        } else {\n          setInsights(data.insights || []);\n        }\n        setLoading(false);\n      })\n      .catch(err => {\n        console.error('Failed to fetch insights:', err);\n        setInsights([]);\n        setLoading(false);\n      });\n  }, [currentLapNumber, referenceLapNumber]);\n\n  // Determine which insight to show based on current position\n  useEffect(() => {\n    if (!lapData?.telemetry || !insights.length || currentIndex === undefined) {\n      setActiveInsight(null);\n      return;\n    }\n\n    const currentPoint = lapData.telemetry[Math.floor(currentIndex)];\n    if (!currentPoint) {\n      setActiveInsight(null);\n      return;\n    }\n\n    // Check if we're at the braking zone entry for any insight\n    // Show tip when within 30m of the braking point (where the mistake happens)\n    let nearbyInsight: Insight | null = null;\n    for (const insight of insights) {\n      const distToCorner = currentPoint.distance - insight.brakingDistance;\n      // Show when approaching and at the braking zone (-10m to +30m window)\n      if (distToCorner >= -10 && distToCorner <= 30) {\n        nearbyInsight = insight;\n        break;\n      }\n    }\n\n    setActiveInsight(nearbyInsight);\n  }, [currentIndex, lapData, insights]);\n\n  if (!referenceLapNumber) {\n    return (\n      <div className=\"bg-black border border-zinc-800 p-4 h-full\">\n        <div className=\"text-center text-zinc-500 py-8\">\n          <div className=\"text-sm\">Select a reference lap to view performance analysis and improvement recommendations</div>\n        </div>\n      </div>\n    );\n  }\n\n  const getConfidenceColor = (confidence: string) => {\n    switch (confidence) {\n      case 'high': return 'bg-green-500/20 text-green-400 border-green-500';\n      case 'medium': return 'bg-yellow-500/20 text-yellow-400 border-yellow-500';\n      case 'low': return 'bg-orange-500/20 text-orange-400 border-orange-500';\n      default: return 'bg-zinc-500/20 text-zinc-400 border-zinc-500';\n    }\n  };\n\n  const getTypeColor = (type: string) => {\n    switch (type) {\n      case 'braking': return 'bg-red-500/10 border-red-500/30';\n      case 'apex': return 'bg-yellow-500/10 border-yellow-500/30';\n      case 'exit': return 'bg-blue-500/10 border-blue-500/30';\n      case 'gforce': return 'bg-purple-500/10 border-purple-500/30';\n      default: return 'bg-zinc-500/10 border-zinc-500/30';\n    }\n  };\n\n  return (\n    <div className=\"bg-black border border-zinc-800 h-full flex flex-col\">\n      <div className=\"border-b border-zinc-800 px-4 py-3\">\n        <h3 className=\"text-sm font-semibold text-white uppercase tracking-wider\">\n          Improvement Tips\n        </h3>\n        <p className=\"text-xs text-zinc-500 mt-1\">\n          Based on comparison with Lap {referenceLapNumber}\n        </p>\n      </div>\n\n      <div className=\"flex-1 overflow-y-auto p-4 space-y-3\">\n        {loading ? (\n          <div className=\"text-center text-zinc-500 py-8\">\n            <div className=\"text-sm\">Analyzing...</div>\n          </div>\n        ) : !activeInsight ? (\n          <div className=\"text-center text-zinc-500 py-8\">\n            <div className=\"mb-3\">\n              <div className=\"inline-flex items-center justify-center w-16 h-16 rounded-full bg-yellow-500/10 border border-yellow-500/30\">\n                <span className=\"text-3xl\">!</span>\n              </div>\n            </div>\n            <div className=\"text-sm font-medium text-white mb-1\">No Active Tips</div>\n            <div className=\"text-xs\">Tips will appear as you reach improvement zones on track</div>\n          </div>\n        ) : (\n          <div className={`border p-4 ${getTypeColor(activeInsight.type)} animate-pulse-slow`}>\n            <div className=\"flex items-start gap-3\">\n              <div className=\"flex-1 min-w-0\">\n                <div className=\"flex items-center gap-2 mb-2\">\n                  <span className=\"text-yellow-400 font-bold text-lg\">Turn {activeInsight.corner}</span>\n                  <span className={`text-[10px] px-2 py-0.5 border uppercase tracking-wider ${getConfidenceColor(activeInsight.confidence)}`}>\n                    {activeInsight.confidence}\n                  </span>\n                </div>\n                <div className=\"text-sm font-semibold text-white mb-2\">{activeInsight.title}</div>\n                <div className=\"text-xs text-zinc-300 leading-relaxed\">{activeInsight.description}</div>\n                <div className=\"text-[10px] text-zinc-500 mt-3\">\n                  Estimated gain: <span className=\"text-green-400 font-mono font-bold\">{activeInsight.potentialGain}</span>\n                </div>\n              </div>\n            </div>\n          </div>\n        )}\n      </div>\n    </div>\n  );\n}\n"],"names":[],"mappings":"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"}}]
}